#!/usr/bin/env expect

proc timed_out {waiting_for} {
	puts "Timed out while waiting for ${waiting_for}!"
	exit 1
}

log_user 0
spawn qemu-system-x86_64 -drive format=raw,file=out/stahlos.img,if=ide,media=disk -m 64M -nographic

expect {
	"Booting `StahlOS'" {}
	timeout { timed_out "GRUB" }
}

expect {
	eof {}
	timeout { timed_out "shutdown" }
}

puts "Expect tests passed!"
